#!/usr/bin/env python3
# This file is placed in the Public Domain.
#
# pylint: disable=C0412,C0115,C0116,W0212,R0903,C0207,C0413,W0611
# pylint: disable=C0411,E0402,E0611,C2801


"daemon"


import getpass
import os
import sys
import time


from bot.configs import Cfg
from bot.scanner import scan
from bot.storage import Storage
from bot.utility import daemon, forever, privileges


from bot import modules


Cfg.pidfile   = os.path.join(Cfg.workdir, "{Cfg.name}.pid")
Cfg.starttime = time.time()
Cfg.user      = getpass.getuser()
Cfg.mod       = ",".join(modules.__dir__())


Storage.workdir = Cfg.workdir


def main():
    daemon(Cfg.pidfile)
    privileges(Cfg.user)
    scan(modules, Cfg.mod, True)
    forever()


if __name__ == "__main__":
    main()
